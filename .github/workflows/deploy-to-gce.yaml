    name: Deploy .NET Core to GKE

    on:
      push:
        branches:
          - main

    env:
      DOCKER_IMAGE_NAME: gcpsantanubhunia/dotnetapp
      GKE_CLUSTER: dotnetapp-cluster
      GKE_ZONE: us-central1-c
      DEPLOYMENT_NAME: dotnetapp-gke

    jobs:
      build-and-deploy:
        runs-on: ubuntu-latest
        steps:
          - name: Checkout code
            uses: actions/checkout@v4

          # - name: Set up .NET
          #   uses: actions/setup-dotnet@v4
          #   with:
          #     dotnet-version: '8.0.x' # Or your specific .NET Core version

          # - name: Build and Publish .NET Core App
          #   run: dotnet publish YourApp.csproj -c Release -o publish

          - name: Login to Docker Hub
            uses: docker/login-action@v3
            with:
              username: ${{ secrets.DOCKER_USERNAME }}
              password: ${{ secrets.DOCKER_TOKEN }}

          - name: Build and Push Docker Image
            uses: docker/build-push-action@v5
            with:
              context: .
              push: true
              tags: ${{ env.DOCKER_IMAGE_NAME }}:latest

          - name: Authenticate to Google Cloud
            uses: google-github-actions/auth@v2
            with:
              credentials_json: ${{ secrets.GCP_SA_KEY }}

          - name: Set up GKE credentials
            uses: google-github-actions/get-gke-credentials@v2
            with:
              cluster_name: ${{ env.GKE_CLUSTER }}
              zone: ${{ env.GKE_ZONE }}

          - name: Deploy to GKE
            run: |
              kubectl apply -f deployment.yaml
              kubectl apply -f service.yaml